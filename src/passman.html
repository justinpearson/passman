<html>
<head>
  <title>Encrypted Text File</title>
  <style>
    #account, #field {
      width: 10em;
    }

    .good {
      outline: 1px solid lightgreen;
    }
    .bad {
      outline: 1px solid red;
    }

    input[type=text], input[type=password] {
      max-width: 10em;
    }

    table {
      border-collapse: collapse;
    }
    th,td {
      border: 1px solid black;
      vertical-align: text-top;
    }

    #bulk-operations {
      padding: 1em;
      border-right: 1px solid black;
      margin-right: 1em;
      max-width: 20em;
    }

    .column-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .row-container {
      display: flex;
      flex-direction: row;
      align-items: center;
    }

    ul.spacey > li {
      margin-bottom: 1.5em;
    }

    #status {
      overflow: auto;
      width: 100%;
      height: 4em;
    }
  </style>
</head>
<body>

<div id="status"></div>

<table>
  <tr>
    <td style="padding: 1em; border: 5px solid black; height: 1px; width: 40%">
      <p><strong>Load/Save</strong></p>
      <ul class="">
        <li>
          <input type="password" id="decryption-password" placeholder="decryption password" />
          <button id="decrypt-button">Decrypt To Working Memory</button>
        </li>
        <li>
          <input type="password" id="encryption-password" placeholder="encryption password" />
          <button id="save-button">Encrypt &amp; Save Working Memory</button>
        </li>
  </ul>
    </td>

    <td rowspan="2" style="padding: 1em; border: 5px solid black; height: 100%; width: 60%">
      <strong>Query Working Memory</strong>
      <ul class="spacey">
        <li>
          <button id="copy-plaintext-button" class="unlocked-only">Copy Working Memory To Clipboard As JSON</button>
        </li>
        <li class="">
          Filter working memory: <br />
          <input type="text" class="query-field" id="copy-field--account" placeholder="account" /><input type="text" class="query-field" id="copy-field--field" placeholder="field" />

          <ul>
            <li>(queries must match beginnings of account/field names)</li>
            <li>(Space means "1 or more characters", so e.g. "a z" would match "amazon")</li>
            <li>(hit Enter to copy first match)</li>
          </ul>

          <div id="view-holder"></div>

        </li>
      </ul>
    </td>

  </tr>
  <tr>
    <td style="padding: 1em; border: 5px solid black">
      <strong>Modify Working Memory</strong>
      <ul class="spacey">
        <li class="">
          <button id="set-field-button">Set</button>
          <input type="text" class="query-field" id="set-field--account" placeholder="account" /><input type="text" class="query-field" id="set-field--field" placeholder="field" />
          to
          <input type="password" id="set-field--value" placeholder="new value" />
          (leave empty to delete)
        </li>
        <li class="">
          <button id="import-plaintext-button">Import JSON</button> by pasting it here:
          <input id="import-plaintext-field" type="password" />
        </li>
      </ul>
    </td>
  </tr>
</table>

<br />
<hr />
<br />

<details>
  <summary><strong>Help</strong></summary>

  <details style="margin: 0.5em; border-left: 1px solid black; padding-left: 0.5em">
    <summary>Tutorial</summary>

    <p>This password manager is a standalone HTML file that contains some encrypted data, as well as tools for querying it, manipulating it, and saving the manipulated data.</p>

    <p>This approach is a little wonky in places for technical reasons, but on the plus side:</p>
    <ul>
      <li>
        It's super-portable; assuming you have a modern browser, this will work out of the box, without installing anything or using any tools you're unfamiliar with. (Contrast with: GPG.)
      </li>
      <li>
        It's super-simple. Your passwords are stored as a simple JSON object, serialized and encrypted with a standard, widely-supported stream cipher (specifically, AES-256 in GCM mode, the key computed by PBKDF2-ing the SHA-256 of your master password). You can trivially export all your data as JSON; and if this page "just stops working" somehow, you can easily recover your data using a text editor and a Python script (see "I can't recover my passwords!" below). (Contrast with: everything that's not GPG.)
      </li>
    </ul>

    <p><strong>Model</strong></p>

    <p>You have many accounts, and many secrets for each account. This password manager stores this as a two-level JSON object, like</p>
    <pre>
      {
        "amazon": {
          "email": "potato.king@gmail.com",
          "password": "pw-for-amazon",
          "username": "potato.king@gmail.com"
        },
        "facebook": {
          "email": "yet.another.alias@gmail.com",
          "password": "pw-for-facebook",
          "username": "yet.another.alias@gmail.com"
        },
        "github": {
          "password": "pw-for-github",
          "username": "leethacker"
        },
        ...
      }
    </pre>

    <p>It's <i>a little bad</i> if bad guys get ahold of the account/field names; it's <strong>disastrous</strong> if they get ahold of the values (e.g. "pw-for-amazon"). This password manager is designed to protect the account/field names <i>somewhat</i> (they're stored encrypted on disk, but still displayed on the screen), and the field values ("secrets") <strong>energetically</strong> (they are encrypted on disk, <i>never</i> displayed on the screen, and they only <i>ever</i> leave the JavaScript interpreter's memory in plaintext by being copied to the clipboard when you ask for them to be).</p>

    <p>(The following model with "working memory" might be unintuitive. Sorry! The reasons are: JavaScript can't overwrite files, only download new ones; and browsers love caching, so we need to make sure none of your secrets ever touch anything the browser might save in a cache somewhere.)</p>

    <p>At any given time, this page has one of these two-level objects stored in "working memory." This is the object that you query and modify. It starts out empty; you can modify that object in various ways, or embed it (encrypted) in a copy of this file which is downloaded.</p>
    <p>There is also such an object embedded in <i>this</i> file. You can decrypt that encrypted object and merge it into working memory by typing the decryption password into the top-left password field, then hitting "Decrypt". (Go on, try it! The default password is "master".)</p>
    <p>I imagine that most of your interactions with this page will be to copy passwords. In the right-hand pane, under "Filter working memory", you can type the first couple characters of an account's/field's name to filter working memory, then hit Enter (or click the button for a field) to copy the field to your clipboard. (Try it! With the default data, type "a" and "p" into the Account and Field inputs, then hit Enter -- "pw-for-amazon" will be copied to your clipboard.)</p>
    <p>The left-hand pane provides tools for modifying working memory: you can update a single field, or paste a JSON object into the "Import JSON" text field and then click the button to import it. You can then save the page with the "Save" button in the top-left, or you'll be asked to save your data if you try to close the page while there are unsaved changes.</p>
    <p>To wipe working memory (~= "log out" of a traditional password manager), just close/reload the page. This will obliterate the JavaScript interpreter state, which is the only place any secrets are ever stored.</p>
  </details>

  <details style="margin: 0.5em; border-left: 1px solid black; padding-left: 0.5em">
    <summary>I can't recover my passwords!</summary>
    <p>
      If this web page isn't working for you, you can use
      <a href="https://github.com/speezepearson/passman/blob/master/recover.py">this Python script</a>
      to recover them: in a terminal, run <code>pip install cryptodomex &amp;&amp; python recover.py html &lt; &lt;this file&gt;</code>.
    </p>
    <p>
      If Cryptodome stopped being maintained or something: sorry, you'll have to roll up your sleeves and:
    </p>
    <ul>
      <li>pull the encrypted message out of this file (it's a JSON object inside the div with id="encrypted-message")</li>
      <li>run your master password (UTF8-encoded) through SHA-256</li>
      <li>run that hash through PBKDF2 (with the parameters given by the encrypted message's <code>keyDerivationAlgorithm</code>)</li>
      <li>use that key to decrypt the encrypted message's <code>ciphertext</code> using the encrypted message's <code>encryptionAlgorithm</code> (by default, AES-256 in Galois/Counter Mode).</li>
    </ul>

    (JavaScript combines the GCM authentication-tag with the ciphertext, and you may need to slice them apart if your crypto library expects them separately. The last 16 bytes of the encrypted message's "ciphertext" field are the tag, and the rest are the key.)
  </details>

</details>


  <div hidden="" class="encrypted-message" id="encrypted-message">{"keyDerivationAlgorithm":{"name":"PBKDF2","hash":"SHA-256","iterations":100000,"salt":[124,133,52,131,223,62,209,148,76,80,33,113]},"encryptionAlgorithm":{"name":"AES-GCM","length":256,"iv":[173,82,22,20,145,17,210,253,236,225,153,9]},"ciphertext":[255,63,5,84,184,252,102,187,130,149,116,83,129,4,76,1,143,232,63,73,106,16,197,232,100,43,197,230,235,104,53,193,116,239,114,142,253,173,0,1,136,5,34,31,116,27,33,92,151,200,19,24,12,117,166,114,220,31,116,187,183,250,98,16,84,231,11,108,26,69,226,229,226,124,32,43,57,214,69,17,195,242,140,140,78,140,238,167,9,80,42,76,9,103,117,189,30,33,25,115,123,230,255,15,221,146,210,31,143,194,255,173,159,24,13,33,47,73,161,62,95,77,197,235,208,170,107,17,231,67,230,46,30,83,219,157,147,192,16,140,181,213,82,10,49,99,134,88,49,105,36,142,170,76,234,36,217,59,17,129,60,193,51,221,71,85,184,202,45,215,192,115,72,190,11,134,37,78,200,79,89,38,66,228,158,29,247,90,253,17,156,225,249,21,98,124,94,131,235,166,99,170,29,7,24,255,35,217,84,158,195,140,83,203,198,217,151,95,45,68,107,194,172,83,17,89,110,157,74,42,176,12,212,26,196,68,189,97,35,168,255,249,214,158,200,31,184,203,109,71,123,190,130,183,30,101,167,105,203,189,250,45,13,141,29,252,8,117,219,14,28,143,144,201,67,226,229,247,101,95,196,82,102,150,64,19,223,96,103,45,200,98,22,158,172,13,21,35,131,108,13,79,57,18,254,123,84,220,148,7,144,230,246,58,101,9,94,67,128,235,141,11,66,249,100,134,6,146,79,202,45,234,19,255,118,10,35,39,195,133,43,157,3,46,246,136,217,219,127,107,234,216,41,239,45,246,215,0,93,38,42,242,44,160,231,163,47,72,77,127,222,208,104,253,94,0,69,218,145,249,30,236,76,70,171,218,17,39,108,194,84,84,114,85,86,79,12,21,235,14,29,142,137,81,85,42,107,227,69,34,9,197,239,109,101,21,254,123,206,124,233,105,4,173,224,214,151,130,219,188,175,153,215,190,91,89,96,240,68,230,196,178,34,57,26,114,17,9,53,223,250,151,44,31,89,178,209,217,23,154,85,150,97,107,69,243,171,169,223,190,33,132,8,198,59,12,218,250,203,146,120,10,48,236,17,28,200,92,226,189,48,149,15,208,11,218,247,246,117,157,137,26,182,131,10,94,22,50,181,176,61,54,195,134,166,19,133,198,136,227,190,121,160,9,175,220,9,255,223,177,115,237,32,238,174,133,138,42,224,128,159,5,78,99,180,32,135,196,153,140,14,108,82,29,67,10,67,155,141,47,48,71,19,3,88,8,247,104,153,250,16,41,123,72,201,156,198,125,172,87,100,22,60,134,55,91,248,50,61,116,238,2,160,162,84,157,78,47,237,235,71,173,31,252,30,147,218,37,8,140,249,172,45,151,197,102,89,84,31,69,240,239,242,28,107,175,9,170,0,64,77,242,128,138,75,222,121,64,140,79,249,5,109,233,138,69,246,1,84,0,52,211,149,253,139,195,191,99,12,105,153,99,114,150,231,104,72,30,186,37,202,131,242,154,207,7,171,19,178,154,96,27,167,106,4,146,169,253,192,251,227,183,56,175,223,114,85,113,181,226,189,175,179,196,173,242,84,52,254,45,201,242,241,138,173,194,208,13,137,225,114,12,91,204,134,28,139,160,129,51,146,170,241,182,210,55,200,142,240,210,183,5,35,137,102,79,123,82,83,45,211,56,57,188,78,98,255,72,63,206,151,134,229,31,117,67,180,236,132,225,67,228,211,92,145,54,158,52,107,83,163,129,19,28,24,152,137,38,79,47,136,55,48,93,110,103,197,203,131,197,3,251,222,166,168,5,174,145,10,179,41,83,12,86,51,69,171,208,141,80,166,198,128,19,72,153,91,195,96,200,228,210,164,145,108,120,215,174,121,237,15,239,185,159,231,106,135,124,209,141,241,53,128,162,174,134,18,204,153,154,121,186,193,83,69,166,182,160,18,128,173,87,79,23,127,44,112,169]}</div>


</body>
</html>
